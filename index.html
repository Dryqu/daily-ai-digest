<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Daily Digest</title>
  <!-- IMPORTANT for GitHub Project Pages under /daily-ai-digest/ -->
  <base href="/daily-ai-digest/">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 40px auto; line-height: 1.6; }
    h1 { border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    .archive { margin-top: 40px; }
    .muted { color: #666; }
  </style>
</head>
<body>
  <h1>ðŸ§  AI Daily Digest</h1>
  <div id="latest-content">Loading todayâ€™s digestâ€¦</div>

  <div class="archive">
    <h2>ðŸ“… Previous Digests</h2>
    <ul id="archive-list"><li class="muted">Loading archiveâ€¦</li></ul>
  </div>

  <script>
    // Local (non-UTC) YYYY-MM-DD
    function ymdLocal(date = new Date()) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    async function fetchText(url) {
      const res = await fetch(url, { cache: "no-cache" });
      if (!res.ok) throw new Error(res.status);
      return res.text();
    }

    // Try today, then up to N-1 previous days
    async function loadLatest(maxDaysBack = 7) {
      const slot = document.getElementById('latest-content');
      const now = new Date();

      for (let i = 0; i < maxDaysBack; i++) {
        const dt = new Date(now);
        dt.setDate(now.getDate() - i);
        const path = `posts/${ymdLocal(dt)}-ai-digest.html`;
        try {
          const html = await fetchText(path);
          slot.innerHTML = html;
          return;
        } catch (_) { /* try previous day */ }
      }

      slot.innerHTML = `
        <p>No digest available for the last ${maxDaysBack} days.</p>
        <p class="muted">Add a file like <code>posts/${ymdLocal()}-ai-digest.html</code> to publish todayâ€™s digest.</p>
      `;
    }

    async function loadArchive() {
      const list = document.getElementById('archive-list');
      try {
        const html = await fetchText('archive.html');
        list.innerHTML = html; // expected to contain <li>â€¦</li> items
      } catch {
        list.innerHTML = '<li class="muted">No archive yet.</li>';
      }
    }

    loadLatest();
    loadArchive();
  </script>
</body>
</html>
